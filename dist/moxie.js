!function(e){var t={};function n(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(s,o,function(t){return e[t]}.bind(null,o));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){function n(e,t){if(e.skillMap)for(const n in e.skillMap){const s=e.skillMap[n];s.id||(s.id=n.substr(1)),t.push(s)}if(e.buffMap)for(const n in e.buffMap){const s=e.buffMap[n];s.id||(s.id=n.substr(1)),t.push(s)}let n={},r={},a={},i=e.players.map((e,t)=>Object.assign({id:t},e)),l=!1;for(let t=0;t<e.players.length;t++){if(e.players[t].hasOwnProperty("details")){let{buffs:o,casts:a}=s(e.players[t].details);n[t]=o,r[t]=a}else{let{buffs:s,casts:a}=o(e.players[t]);l=!0,n[t]=s,r[t]=a}const i=e.players[t].targetDamage1S;i&&i[0]&&(a[t]=i[0][0])}let c={};for(let e of t)c[e.id]=e.name;let d=l?1:1e3;return{boss:e.fightName,players:i,start:e.phases[0].start*d,end:e.phases[0].end*d,skills:c,casts:r,buffs:n,targetDamage1S:a}}function s(e){let t={};for(let n of e.boonGraph[0]){t[n.id]=[];let e=0;for(let s of n.states){let o=1e3*s[0],r=s[1];for(let s=0;s<Math.abs(r-e);s++)r>e?t[n.id].push({Apply:o}):t[n.id].push({Remove:o});e=r}}let n=[];for(let t of e.rotation)if(t[0])for(let t of e.rotation[0]){let e=1e3*t[0],s=t[1],o=t[2],r=t[3];t[4];n.push({id:s,start:e,end:e+o,fired:2!==r})}return{buffs:t,casts:n}}function o(e){let t={},n=[];for(let n of e.buffUptimes){t[n.id]=[];let e=0;for(let s of n.states){let[o,r]=s;for(let s=0;s<Math.abs(r-e);s++)r>e?t[n.id].push({Apply:o}):t[n.id].push({Remove:o});e=r}}e.rotation||(e.rotation=[]);for(let t of e.rotation){let e=t.id;for(let s of t.skills){let t=s.castTime,o=t+s.duration,r=s.duration+s.timeGained>0;n.push({id:e,start:t,end:o,fired:r})}}return{buffs:t,casts:n}}e.exports={parseJson:function(e){return n(e,[])},getJson:async function(e){const t=await fetch(`https://dps.report/getJson?permalink=${e}`),s=await t.json();if(!s.hasOwnProperty("error"))return n(s,[]);alert(`failed to fetch that log, message from dps.report: "${s.error}"`)}}},function(e,t,n){"use strict";n.r(t);var s=new class{constructor(){this.loadSkill=this.loadSkill.bind(this),this.data={}}load(e){return Promise.all(Object.keys(e).map(this.loadSkill))}async loadSkill(e){try{const t=await fetch(`api-cache/${e}.json`),n=await t.json();this.data[e]=n}catch(t){console.log("could not fetch",e),await this.loadSkillFromAPI(e)}}async loadSkillFromAPI(e){try{const t=await fetch(`https://api.guildwars2.com/v2/skills/${e}`),n=await t.json();this.data[e]=n}catch(t){console.log("really could not fetch",e)}}get(e){return this.data[e]}},o=5736,r=5737,a=42086,i=40183,l=43470,c=42264,d=44857,u=5539,h=45313,f=43803,p=5557,g=42416,m=5516,w=5531,b=5517,y=34241,v=44597,k=33162,S=30868,_=10285,A=10229,$=10190,L=43761,x=44321,C=21750,E=10221,M=10174,F=10267,D=10282,P=30525,R=29856,B=30814,O=10236,N=30359,T=43638,j="-12",q="-11",I="-8",W="-6",G="-16",H="-14",J="-10",U="-7",X="-5",z=5624,V=29613,K=14354,Y=44846,Z=9098,Q=9089,ee=9154,te=29632,ne=30232,se=30029,oe=45717,re=12492,ae=33902,ie=45600,le=28357,ce=27890,de=26646,ue=29921;class he{constructor(e,t,n){this.start=e,this.end=t,this.label=n}render(e){const t=document.createElement("li");t.classList.add("mishap");const n=document.createElement("a"),s=((this.start-e.start)/1e3).toFixed(2),o=((this.end-e.start)/1e3).toFixed(2);return n.dataset.start=this.start,n.dataset.end=this.end,n.innerHTML=`${s}s&mdash;${o}s`,n.href="#",n.classList.add("time-link"),t.appendChild(n),this.label&&t.appendChild(document.createTextNode(" "+this.label)),t}}const fe=document.querySelector(".report-card-items");function pe(e,t,n){if(0!==e.casts.length)switch(n.id){case"weaver_power_btth_small":case"weaver_power_fa_small":me(e),we(e),be(e),function(e){let t=e.start+16e3,n=3,s=0;const o=[];let r=!1;for(const a of e.casts)if(a.id===u){r=!0;let e=-1;for(;a.start>t&&t>=0;)n<3?n+=1:(s+=1,e=Math.min(e,t)),t+=16e3;e>0&&o.push(new he(e,a.start)),n-=1,t<0&&(t=a.start+16e3)}t<e.end&&(s+=Math.floor((e.end-t)/16e3),o.push(new he(t,e.end)));if(!r)return;let a="D";s<1?a="S":s<2?a="A":s<4?a="B":s<6&&(a="C");if(t>=0){ge(e,a,`Lost ${s} ${1===s?"charge":"charges"} of Arcane Blast`,o)}else ge(e,"S","Missing Arcane Blast casts",[])}(e),ye(e),ve(e,g,100),function(e,t){let{firstStart:n,firstEnd:s,secondStart:o,secondEnd:r}=ke(t.casts),{firstStart:a,firstEnd:i,secondStart:l,secondEnd:c}=ke(e.casts);if(console.log(ke(t.casts),ke(e.casts)),a<0)return void ge(e,"D","Didn't use FGS at all",[]);if(l<0)return void ge(e,"D","Didn't pick up second FGS",[]);const d=i-a,u=c-l,h=s-n,f=r-o,p=a-e.start-n+(d-h)+(l-e.start-o)+(u-f);console.log("fgs diff",p,a,i,l,c);let g="D";p<500?g="S":p<1e3?g="A":p<2e3?g="B":p<4e3&&(g="C");function m(e){return`${10*Math.round(e/10)/1e3}s`}console.log("wait what",o);const w=[new he(a,i,`First FGS (bench is ${m(n)}-${m(s)})`),new he(l,c,`Second FGS (bench is ${m(o)}-${m(r)})`)];ge(e,g,`Goofed around with FGS for ${(p/1e3).toFixed(2)} seconds`,w)}(e,n),Se(e,o),Se(e,r);break;case"weaver_power_btth_large":case"weaver_power_fa_large":me(e),we(e),be(e),ye(e),ve(e,g,100),Se(e,r);break;case"daredevil_power":me(e,!0),we(e),ve(e,v,30),ve(e,k,65),Se(e,S);break;case"mirage":me(e),we(e),_e(e,x,42/144),_e(e,L,16/144),Se(e,_),Se(e,A),Se(e,$);break;case"chrono_power_gs":{me(e),we(e);const t={resets:new Set([C])},n=Object.assign({leniency:2},t);Se(e,C),Se(e,E,n),Se(e,M,t),Se(e,F,t),Se(e,P);break}case"chrono_power_focus":{me(e),we(e);const t={resets:new Set([C])},n=Object.assign({leniency:2},t);Se(e,C),Se(e,M,t),Se(e,F,t),Se(e,D,n);break}case"chrono_power_boon":{me(e),we(e);const t={resets:new Set([C])},n=Object.assign({leniency:2},t);Se(e,C),Se(e,M,n),Se(e,O),Se(e,B),Se(e,R);break}case"chrono_condi_boon":me(e),we(e),Se(e,O),Se(e,B),Se(e,R);break;case"firebrand_condi":case"firebrand_condi_quick":me(e),we(e),function(e,t,n,o){const r=s.get(t);if(!r)return void console.warn("Missing skill data",t);let a=o,i=e.start+n,l=0;const c=[];let d=!1;for(const s of e.casts)if(s.id===t){d=!0;let e=-1;for(;s.start>i&&i>=0;)a<o?a+=1:(l+=1,e=Math.min(e,i)),i+=n;e>0&&c.push(new he(e,s.start)),a-=1,i<0&&(i=s.start+n)}i<e.end&&(l+=Math.floor((e.end-i)/n),c.push(new he(i,e.end)));if(!d)return;let u="D";l<1?u="S":l<2?u="A":l<4?u="B":l<6&&(u="C");if(i>=0){const t=`Lost ${l} ${1===l?"charge":"charges"} of ${r.name}`;ge(e,u,t,c)}}(e,Y,12800,4),function(e,t,n){const o=s.get(t);if(!o)return void console.warn("Missing skill data",t);const r=[];for(const n of e.casts)n.fired&&n.id===t&&r.push(new he(n.start,n.end));let a="D",i=r.length;i-=n,i<1?a="S":i<2?a="A":i<4?a="B":i<6&&(a="C");i+=n;const l=1===i?"time":"times",c=`Cast bad skill ${o.name} ${i} ${l}`;ge(e,a,c,r)}(e,Z,6),function(e,t,n,o){const r=s.get(t);if(!r)return void console.warn("Missing skill data",t);const a=[];let i=[],l=0;for(const s of e.casts)if(s.fired)if(s.id===t)i.push(s),i.length>n&&(a.push(new he(s.start,s.end)),l+=s.end-s.start);else{if(0===i.length)continue;s.start-i[0].end>o&&(i=[])}let c="D",d=a.length;d<1?c="S":d<2?c="A":d<4?c="B":d<6&&(c="C");const u=1===d?"time":"times",h=`Spammed ${r.name} too much ${d} ${u} (lost ${(l/1e3).toFixed(2)}s)`;ge(e,c,h,a)}(e,Q,2,5e3);break;case"soulbeast_power_moa_gs":case"soulbeast_power_moa_lb":me(e),we(e),Se(e,oe),Se(e,re),ve(e,ae,45),ve(e,ie,97);break;case"renegade_kalla":case"renegade_deva_kalla":case"renegade_shiro":me(e),we(e),function(e,t,n){const o=s.get(t);if(!o)return void console.warn("Missing skill data",t);let r=[],a=[];for(const s of e.casts)if(s.id===t&&(a.push(s.end-s.start),s.end-s.start>n)){let e=(s.end-s.start-n)/1e3;r.push(new he(s.start+n,s.end,`Over by ${e.toFixed(2)}s`))}console.log("cast times",a);let i=0;for(let e of a)i+=e-n;let l="D";i<200?l="S":i<500?l="A":i<1e3?l="B":i<2e3&&(l="C");const c=`Left ${(i/1e3).toFixed(2)}s worth of ${o.name} uncancelled`;ge(e,l,c,r)}(e,le,600),Ae(e);break;default:console.warn("Nothing cool to do for",n.id),me(e),we(e),Ae(e)}else console.warn("Log has no casts")}function ge(e,t,n,s){const o=document.createElement("li");o.classList.add("report-card-item");const r=document.createElement("span");r.classList.add("grade","grade-"+t.toLowerCase()),r.textContent=t;const a=document.createElement("span");a.classList.add("explanation"),a.textContent=n;const i=document.createElement("div");i.classList.add("report-card-item-expander"),i.textContent="Show Mishaps",i.addEventListener("click",(function(){o.classList.contains("open")?(i.textContent="Show Mishaps",o.classList.remove("open"),o.parentNode.classList.remove("single")):(i.textContent="Hide Mishaps",o.classList.add("open"),o.parentNode.classList.add("single"))})),o.appendChild(r),o.appendChild(document.createTextNode(" ")),o.appendChild(a),o.appendChild(i);const l=document.createElement("ul");l.classList.add("mishap-list");for(let t of s)l.appendChild(t.render(e));o.appendChild(l),fe.appendChild(o),console.log("additional data",s)}function me(e,t){const n=[];for(const t of e.casts){if(!t.fired)continue;let e=s.get(t.id);if(e&&e.slot){if("Weapon_1"!==e.slot)continue;if(!e.prev_chain&&e.next_chain&&n.push([t]),e.prev_chain){if(!n[n.length-1]){console.warn("Phantom chain!",t);continue}n[n.length-1].push(t)}}}let o={chains:[],total:0},r={chains:[],total:0};for(let e of n)3!==e.length&&(console.log("bad chain of length",e.length),e.length>3&&console.log("wait what",e),1===e.length?(o.total+=e[e.length-1].end-e[0].start,o.chains.push(e)):2===e.length&&(r.total+=e[e.length-1].end-e[0].start,r.chains.push(e)));console.log("wastedOne",o),console.log("wastedTwo",r);const a=e.casts[e.casts.length-1].end-e.casts[0].start;if(console.log("eliminating one",1-(a-o.total)/a),console.log("eliminating two",1-(a-r.total)/a),t){let t="";t=0===o.chains.length?"S":o.chains.length<3?"A":o.chains.length<7?"B":o.chains.length<15?"C":"D";let n="attack";1!==o.chains.length&&(n+="s"),ge(e,t,`Let ${o.chains.length} single auto ${n} happen`,o.chains.map(e=>new he(e[0].start,e[e.length-1].end)))}let i="";i=0===r.chains.length?"S":r.chains.length<2?"A":r.chains.length<5?"B":"C";let l=`Missed ${r.chains.length} auto chain finisher`;1!==r.chains.length&&(l+="s"),ge(e,i,l,r.chains.map(e=>new he(e[0].start,e[e.length-1].end)))}function we(e){let t=0,n=[],s=0,o=[],r=-1;for(const a of e.casts)if(a.end!==a.start){if(r>0){let s=a.start-r;s<0?console.log("WHAT",a):(t+=s,s>30&&n.push(new he(r,a.start,e.skills[a.id]||"Unknown skill")))}a.fired||(s+=a.end-a.start,a.end-a.start>30&&o.push(new he(a.start,a.end,e.skills[a.id]||"Unknown skill"))),r=a.end}console.log("deadspace",t),console.log("cancels",s);let a=r-e.casts[0].start;console.log("out of",a),console.log("kills your deeps by",1-(a-t-s)/a);let i="B";t<5e3?i="S":t<1e4&&(i="A"),ge(e,i,`Did nothing for ${(t/1e3).toFixed(2)} seconds`,n);let l="B";s<5e3?l="S":s<1e4&&(l="A"),ge(e,l,`Canceled skills for ${(s/1e3).toFixed(2)} seconds`,o)}function be(e){let t=e.buffs[a];const n=e.buffs[l];if(!t){t=[];let n=1e3,s=5*n,o=e.start-s-n;for(const r of e.casts){if(r.id!==i)continue;let a=r.start-n;a-o<s||(o>e.start&&t.push({Remove:Math.min(o+s,a-1)}),o=a,t.push({Apply:a}))}o>e.start&&t.push({Remove:Math.min(o+s,e.end)})}let s=0,o=-1,r=[],c=0;for(let e of t){if(e.Apply){o<0&&(o=e.Apply);continue}if(e.Remove&&o<0)continue;const t=e.Remove;let a=0;const i=t-o;let l=-1;for(let e=s;e<n.length;e++){let r=n[e];if(r.Apply){l<0&&(l=r.Apply,s=e);continue}if(r.Remove&&l<0)continue;const c=r.Remove;if(c>o&&l<t&&(a+=Math.min(c,t)-Math.max(o,l)),c<t&&l>o){a+=i;break}if(l=-1,c>t)break}const d=a/i;c+=1,d<.8&&r.push({coverage:d,mishap:new he(o,t,`${Math.floor(100*d)}%`)}),o=-1}console.log(r);let d=`Misaligned ${r.length}/${c} Primordial Stance`;1!==r.length&&(d+="s");let u="D";r.length<1?u="S":r.length<2?u="A":r.length<4?u="B":r.length<6&&(u="C"),ge(e,u,d,r.map(e=>e.mishap))}function ye(e){if(!e.buffs.hasOwnProperty(l))return;const t={[h]:!0,[f]:!0,[o]:!0,[p]:!0},n=[],s=e.buffs[l].filter(e=>e.hasOwnProperty("Remove")).values(),r=e.buffs[c].filter(e=>e.hasOwnProperty("Remove")).values();let a=s.next(),i=s.next();for(const o of e.casts){for(;a.value&&a.value.Remove<o.start;)a=s.next();for(;i.value&&i.value.Remove<o.start;)i=r.next();a.value&&a.value.Remove<o.end&&(console.log("ff transition",o,e.skills[o.id]),t[o.id]||n.push(new he(o.start,o.end,e.skills[o.id]))),i.value&&i.value.Remove<o.end&&(console.log("aa transition",o,e.skills[o.id]),t[o.id]||n.push(new he(o.start,o.end,e.skills[o.id])))}let d="D";n.length<1?d="S":n.length<3?d="A":n.length<6?d="B":n.length<14&&(d="C");let u=`Switched attunements during ${n.length} unsafe skill`;1!==n.length&&(u+="s"),ge(e,d,u,n)}function ve(e,t,n){const s=e.buffs[t];let o=0,r=-1,a=-1,i=[];for(let e of s)e.Apply&&r<0&&(a>0&&(e.Apply-a>30&&i.push(new he(a,e.Apply)),o+=e.Apply-a),r=e.Apply),e.Remove&&(a=e.Remove,r=-1);const l=(o/1e3).toFixed(2),c=100-Math.floor(100*o/(e.end-e.start));let d="D";const u=(n-c)/n;u<.02?d="S":u<.05?d="A":u<.1?d="B":u<.25&&(d="C"),ge(e,d,`Had ${c}% uptime on ${e.skills[t]} (dropped for ${l}s, target ${n}%)`,i)}function ke(e){let t=-1,n=-1,s=-1,o=-1,r=!0;for(const a of e)if(r)a.id===m&&(t=a.start),a.id===w&&(n=a.end,r=!1);else{if(!(o<0))break;a.id===b&&(console.log("secondStart",a.start),s=a.start),a.id===w&&(o=a.end)}return{firstStart:t,firstEnd:n,secondStart:s,secondEnd:o}}function Se(e,t,n={}){const o=s.get(t);if(!o)return void console.warn("Missing skill data",t);let r;for(let e of o.facts)"Recharge"===e.type&&(r=1e3*e.value/1.25);if(!r)return void console.warn("Missing skill recharge",t,o);let a=e.start+r,i=0;const l=[];let c=n.resets;for(const n of e.casts)if(c&&c.has(n.id)&&(a=n.end),n.id===t){if(n.start>a){let e=n.start-a;e>200&&l.push(new he(a,n.start)),i+=e}a=n.end+r}let d=Math.floor(i/r),u="D";const h=n.leniency||0;d-=h,d<1?u="S":d<2?u="A":d<4?u="B":d<6&&(u="C"),d+=h,ge(e,u,`Lost ${d} ${1===d?"cast":"casts"} of ${o.name}`,l)}function _e(e,t,n){const o=s.get(t);if(!o)return void console.warn("Missing skill data",t);let r=0;for(const n of e.casts)n.id===t&&(r+=1);let a="D";const i=Math.floor(n*(e.end-e.start)/1e3);i-r<1?a="S":i-r<2?a="A":i-r<4?a="B":i-r<6&&(a="C");const l=1===r?"time":"times";ge(e,a,`Cast ${o.name} ${r}/${i} ${l}`,[])}function Ae(e){ge(e,"S","Missing build-specific advice",[])}const $e={Tempest:!0,Weaver:!0,Chronomancer:!0,Mirage:!0,Reaper:!0,Scourge:!0,Scrapper:!0,Holosmith:!0,Soulbeast:!0,Daredevil:!0,Deadeye:!0,Guardian:!0,Dragonhunter:!0,Firebrand:!0,Herald:!0,Renegade:!0,Berserker:!0,Spellbreaker:!0};class Le{constructor(e){this.boss=e.boss||"Unknown",console.log(e.players),this.players=e.players.filter(e=>$e[e.profession]),this.onSelect=this.onSelect.bind(this),this.elt=null,this.playerSelect=null,this.listener=null}render(){this.elt=document.createElement("div"),this.elt.classList.add("target-select");let e=document.createElement("div");e.classList.add("target-select-boss-label"),e.textContent=this.boss,this.elt.appendChild(e),this.playerSelect=document.createElement("select"),this.playerSelect.classList.add("target-select-player-select");for(let e of this.players){let t=document.createElement("option");t.textContent=e.name,t.value=e.name,this.playerSelect.appendChild(t)}this.elt.appendChild(this.playerSelect);let t=document.createElement("input");t.classList.add("target-select-submit"),t.type="button",t.value="Analyze",t.addEventListener("click",this.onSelect),this.elt.appendChild(t),document.querySelector(".target-select-container").appendChild(this.elt)}remove(){this.elt.parentNode.classList.add("hidden"),this.elt.parentNode.removeChild(this.elt),this.playerSelect=null,this.elt=null}onSelect(){let e=null;for(let t of this.players)this.playerSelect.value===t.name&&(e=t);this.remove(),this.listener(e),this.listener=null}}var xe=n(0),Ce=n.n(xe);async function Ee(e,t){const n=`./benchmarks/${e}.json`,s=await fetch(n),o=await s.json(),r=Ce.a.parseJson(o);return r.casts=r.casts[0],r.buffs=r.buffs[0],r.targetDamage1S=r.targetDamage1S[0],r.id=e,t||(r.name=e.replace(/_/g," ")),r}function Me(e,t){for(let n of e.casts)if(n.id===t)return!0;return!1}function Fe(e,t){for(let n of e.buffUptimes)if(n.id===t)for(let e of n.buffData)for(let t in e.generated)if(e.generated[t]>0)return!0;return!1}const De={[i]:!0},Pe={5663:"4",43995:"F2"};function Re(e){let t=s.get(e.id);if(t&&t.icon)return t.icon}function Be(e,t){let n=s.get(e.id);if(n&&n.slot){let e="",t=n.slot.match(/(Weapon|Downed)_(\d)/);if(t&&t.length>0)e=t[2],n.prev_chain&&!n.next_chain&&(e+="f");else if("Elite"===n.slot)e="E";else if("Utility"===n.slot)e="U";else if("Heal"===n.slot)e="H";else if("Toolbelt"===n.slot)e="T";else{let t=n.slot.match(/Profession_(\d)/);t&&t.length>0&&(e="F"+t[1])}return e}if(t[e.id]){let n=t[e.id];if("Dodge"===n)return"D";if(n.startsWith("Chapter")){let e=n.match(/Chapter (\d)/);if(e&&e.length>0)return"C"+e[1]}else if(n.startsWith("Epilogue"))return"C5"}if(Pe.hasOwnProperty(e.id))return Pe[e.id]}var Oe=function(e,t,n,s,o,r,a="icon"){const{railHeight:i,railPad:l,timeToX:c}=o;for(const o of n){if(De[o.id])continue;const n=document.createElementNS("http://www.w3.org/2000/svg","g"),d=document.createElementNS("http://www.w3.org/2000/svg","title");let u=t.skills[o.id]||o.id;u+=` (${`${((o.start-t.start)/1e3).toFixed(2)}s`}, ${`${((o.end-o.start)/1e3).toFixed(2)}s`})`,d.textContent=u;const h=document.createElementNS("http://www.w3.org/2000/svg","rect");h.classList.add("cast"),o.fired||h.classList.add("cancel"),r&&h.classList.add(r);let f=Re(o),p=null;"icon"===a&&(f?(p=document.createElementNS("http://www.w3.org/2000/svg","image"),p.setAttribute("x",c(o.start)),p.setAttribute("y",(i+l)*s),p.setAttribute("width",i),p.setAttribute("height",i),p.classList.add("icon"),p.setAttribute("href",f)):console.warn("No label for skill",o.id,t.skills[o.id]));let g=Be(o,t.skills),m=null;"name"===a&&(g?(m=document.createElementNS("http://www.w3.org/2000/svg","text"),m.setAttribute("x",c(o.start)),m.setAttribute("y",(i+l)*s+i/2),m.classList.add("name"),m.textContent=g):console.warn("No label for skill",o.id,t.skills[o.id])),h.setAttribute("x",c(o.start)),h.setAttribute("y",(i+l)*s);const w=c(o.end)-c(o.start);w>6?h.setAttribute("width",w):(h.setAttribute("width",2),h.classList.add("cast-instant")),h.setAttribute("height",i),n.appendChild(d),n.appendChild(h),p&&n.appendChild(p),m&&n.appendChild(m),e.appendChild(n)}};const Ne={"Do Nothing Transformation Buff":!0,"Conjure Fire Attributes":!0,"Conjure Fiery Greatsword":!0,"Number of Boons":!0,"Ride the Lightning":!0,"Signet of Restoration":!0,"Elemental Refreshment":!0,"The Light of Deldrimor":!0,"Hylek Language Effect":!0,"Incoming!":!0,"Jump Mushroom Knowledge":!0,"Mushroom Tracking Knowledge":!0,"Nuhoch Alchemy":!0,"Radiant Attunement":!0,"Speed Mushroom Knowledge":!0,"Solar Beam":!0,"Stealth Gliding":!0,"Xera's Fury":!0},Te={"Fire/Fire":0,"Earth/Fire":1,"Earth/Earth":2,"Fire/Earth":3,"Fire/Water":4,"Water/Fire":5,"Water/Earth":6,"Air/Water":7,"Air/Fire":8,"Air/Air":9,"Fire/Air":10,"Primordial Stance":11,"Elements of Rage":12,"Signet of Fire":13,"Glyph of Elemental Power (Fire)":14,"Magnetic Wave":15,"Weaver's Prowess":16,"Persistent Flames":17,"Fire Aura":18,"Air Attunement":0,"Earth Attunement":1,"Fire Attunement":2,"Water Attunement":3,"Transcendent Tempest":4,"Fencer's Finess":0,"Time Anchored":1,"Signet of the Ether":2,"Assassin's Signet (Passive)":0,"Assassin's Signet (Active)":1,"Bounding Dodger":2,Revealed:3,"Lead Attacks":4,"Lotus Training":5,"Skale Venom":6,"Spider Venom":7,"Mirage Cloak":0,"Compounding Power":1,"Legendary Demon Stance":0,"Legendary Assassin Stance":1,"Legendary Renegade Stance":2,"Embrace the Darkness":3,"Impossible Odds":4,"Razorclaw's Rage":5,"Improved Kalla's Fervor":6,"Zealot's Flame":0,"Renewed Focus":1,"Ashes of the Just":2,"Symbolic Avenger":0,"Shield of Wrath":1,"Spear of Justice":2,Justice:3,"Inspiring Virtue":4,"Virtue of Courage":5,"Virtue of Justice":6,"Virtue of Resolve":7,"One Wolf Pack":0,"Sharpening Stone":1,"Sic 'Em!":2,"Twice as Vicious":3,"Reaper's Shroud":0};function je(e,t,n,s){const o=document.createElementNS("http://www.w3.org/2000/svg","g"),r=document.createElementNS("http://www.w3.org/2000/svg","title"),a=document.createElementNS("http://www.w3.org/2000/svg","rect");return a.setAttribute("x",e),a.setAttribute("y",t),a.setAttribute("height",n),a.classList.add("buff"),s?a.classList.add("buff-outline"):o.appendChild(r),o.appendChild(a),o}function qe(e,t,n){const s=e.querySelector("rect");s.setAttribute("width",t(n)-s.getAttribute("x"));const o=e.querySelector("title");if(!o)return;const r=parseFloat(e.dataset.start),a=(parseFloat(e.dataset.start)/1e3).toFixed(2),i=((n-r)/1e3).toFixed(2);o.textContent=`${a}s, ${i}s`}var Ie=function(e,t,n,s,o,r,a,i){const{railHeight:l,railPad:c,timeToX:d}=r;!function(e){const t=e.buffs;if(!t.hasOwnProperty(te))return void console.log("no spear",e);const n=t[te],s=[];for(const e of n){if(!e.hasOwnProperty("Remove"))continue;const t=e.Remove;if(0===t)continue;const n=7980;s.push({Apply:t}),s.push({Remove:t+n})}t[ne]=s,e.skills[ne]="Justice",console.log("did the thing",e)}(n),"Weaver"===s.profession&&Object.assign(Ne,{"Fire Attunement":!0,"Water Attunement":!0,"Air Attunement":!0,"Earth Attunement":!0});for(let e in n.buffs)n.skills[e]||(console.warn("Missing skill name",e),n.skills[e]=`${e}`);let u=n.buffs;if(!a){u={};for(const e in n.buffs){const t=n.skills[e];Ne.hasOwnProperty(t)||Te.hasOwnProperty(t)&&(u[e]=n.buffs[e])}}const h=Object.keys(u).sort((e,t)=>{let s=n.skills[e],o=n.skills[t];return Te.hasOwnProperty(s)?Te.hasOwnProperty(o)?Te[s]-Te[o]:-1:Te.hasOwnProperty(o)?1:s.localeCompare(o)});let f=o;for(const s of h){if(!/^[A-Z]/.test(n.skills[s]))continue;if(n.skills[s].startsWith("Guild"))continue;if(Ne[n.skills[s]])continue;const o=[];for(const t of u[s]){if(t.Apply){const e=je(d(t.Apply),(l+c)*f,l,i);e.dataset.start=t.Apply,o.push(e)}if(t.Remove){let s=o.pop();s||(s=je(d(n.start),(l+c)*f,l,i),s.dataset.start=n.start),qe(s,d,t.Remove),e.appendChild(s)}}for(const t of o.reverse())qe(t,d,n.end),e.appendChild(t);if(!i){const e=document.createElementNS("http://www.w3.org/2000/svg","text");e.textContent=n.skills[s],e.setAttribute("x",0),e.setAttribute("y",f*(l+c)+l/2),e.classList.add("name"),t.appendChild(e)}f+=1}return f-o};function We(e){const t=new Array(e.length);let n=0;for(let s=0;s<e.length;s++){let o=0;s>=10&&(o=e[s-10]);let r=(e[s]-o)/10;t[s]=r,n=Math.max(r,n)}return{dps10s:t,max:n}}function Ge(e,t){const{railHeight:n,railPad:s}=t;let o=2*(n+s)+s,r=1.5*e,a=Math.log(r-e),i=Math.log(r);return function(e){const t=Math.log(r-e);return(a-t)/(a-i)*o+s}}function He(e,t,n,s){const{timeToX:o}=s;let r="",a=Ge(n,s);for(let n=0;n<t.length;n++){r+=0===n?"M":"L",r+=o(1e3*n+e.start)+" "+a(t[n])+" "}const i=document.createElementNS("http://www.w3.org/2000/svg","path");return i.setAttribute("d",r),i.classList.add("dps-path"),i}class Je{constructor(e,t,n,s,o){this.dps10s=t,this.benchDps10s=n,this.timeToX=o.timeToX,this.toY=Ge(s,o),this.elt=document.createElementNS("http://www.w3.org/2000/svg","g"),this.elt.classList.add("tooltip"),this.elt.classList.add("tooltip-hidden"),this.diffLine=document.createElementNS("http://www.w3.org/2000/svg","path"),this.diffLine.classList.add("tooltip-path"),this.explanation=document.createElementNS("http://www.w3.org/2000/svg","text"),this.explanation.classList.add("tooltip-explanation"),this.elt.appendChild(this.diffLine),this.elt.appendChild(this.explanation),e.appendChild(this.elt)}show(e,t){if(t<0)return;let n=this.timeToX(e);this.elt.setAttribute("transform",`translate(${n} 0)`),this.diffLine.setAttribute("d","");let s="",o=0;if(t<this.dps10s.length){let e=this.dps10s[t],n=this.toY(e);if(o=n,t<this.benchDps10s.length){let r=this.benchDps10s[t],a=this.toY(r);o=Math.min(o,(n+a)/2);let i=`M0 ${n} L0 ${a}`;this.diffLine.setAttribute("d",i);let l=e-r;s=`${l>0?"Ahead":"Behind"} ${Math.abs(Math.round(l))} at ${t}s (${Math.round(e)} vs ${Math.round(r)})`}else s=`${Math.round(e)}`}this.explanation.textContent=s,this.explanation.setAttribute("x",2),this.explanation.setAttribute("y",o),this.elt.classList.remove("tooltip-hidden")}hide(){this.elt.classList.add("tooltip-hidden")}}var Ue=function(e,t,n,s){const{railHeight:o,railPad:r,xToTime:a}=s,{dps10s:i,max:l}=We(t.targetDamage1S),{dps10s:c,max:d}=We(n.targetDamage1S),u=Math.max(l,d),h=He(t,i,u,s),f=He(t,c,u,s);f.classList.add("dps-path-benchmark"),e.appendChild(f),e.appendChild(h);let p=2*(o+r)+r;const g=new Je(e,i,c,u,s),m=e.parentNode;let w;e.addEventListener("mousemove",(function(e){if(w||(w=m.getBoundingClientRect()),e.clientY-w.top>p)return void g.hide();let n=e.clientX+m.scrollLeft-w.left,s=a(n),o=Math.round((s-t.start)/1e3);g.show(1e3*o+t.start,o)})),e.addEventListener("mouseleave",(function(){g.hide()}))};const Xe=["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight","b","a","Enter"],ze={notAGoodPlayer:["you are $bad","you make me sick","you should have slash gee geed before you logged in","you should uninstall","uninstall","unplug your computer","you are too heavy for north america, go to europe","you must be from north america","is that you jil","go back to ERPing","I digital vomited in my digital mouth","go play $mmo","think about all the people you have let down with your $bad gameplay","if you want to be rewarded for being so $bad just play $mmo","blocked and reported","why not try some world bosses instead","gwen called, she wants you to uninstall","you made taimi cry","you make gorrik wish he could have joined blish","palawa joko came back but you are so $bad it killed him again","I would rather be in the realm of torment than evaluating gameplay this $bad","thank you for giving me your account name so I can block you"],wastedTime:["in that time I simulated $bigNumber universes, in all of them you were $bad","it took me zero point zero zero $number $number seconds to realize you will never get good","it takes just two minutes to uninstall","you could have downloaded $mmo in that time","were you $afk"],afraid:["afraid","scared"],bad:["trash","bad","terrible","garbage","subpar","disappointing"],mmo:["wow","ffxiv","eso","runescape","guild wars one"],bigNumber:["$number billion","$number hundred $doubleDigitNumber million $number hundred $doubleDigitNumber thousand $number hundred $doubleDigitNumber"],number:["one","two","three","four","five","six","seven","eight","nine"],doubleDigitNumber:["seventeen","twelve","twenty $number","thirty $number","forty $number","fifty $number","sixty $number","seventy $number","eighty $number","ninety $number"],afk:["afk","walking the dog","on a bio break","busy losing a raid tournament because you messed up reflect"],lostCast:["you may hate $spell but I hate your inability to play more","you do realize $spell does damage","$spell is your friend, unlike me","poor thing, in your hands $spell is just as nonexistent as zojja"]},Ve=JSON.stringify(ze);function Ke(e){for(;e.includes("$");){const t=/\$(\w+)/.exec(e);if(!t)return e;const n=ze[t[1]];if(!n||0===n.length)return console.warn("Unable to substitute",t[1]),e;const s=n[Math.floor(Math.random()*n.length)];e=e.replace(t[0],s)}return e}function Ye(){const e=function(){const e=document.querySelectorAll(".report-card-item");if(0===e.length)return"too $afraid to upload a log? $notAGoodPlayer";let t="";for(const n of e){if("S"===n.querySelector(".grade").textContent)continue;let e=`you ${n.querySelector(".explanation").textContent.toLowerCase()}.`;e=e.replace("/"," out of an ideal ");let s="notAGoodPlayer";Math.random()>.3&&(e.includes("cast")?s="lostCast":e.includes("seconds")&&(s="wastedTime"));const o=ze[s];n.dataset.spell?ze.spell=[n.dataset.spell]:ze.spell=["that spell","that ability","that skill","that spell","that ability","that skill","pressing keys"];const r=Math.floor(Math.random()*o.length),a=Ke(o[r]);ze[s].splice(r,1),0===ze[s].length&&(ze[s]=JSON.parse(Ve)[s]),t+=`${e} ${a}. `}return""===t?"maybe you aren't completely $bad. just kidding, $notAGoodPlayer":t}();console.log("doing the thing",e),function(e){const t=window.speechSynthesis,n=new SpeechSynthesisUtterance(e);for(let e of t.getVoices())"Daniel"===e.name&&(n.voice=e);n.rate=1.2,t.speak(n)}(e)}let Ze=0;var Qe=function(){document.body.addEventListener("keydown",(function(e){let t=Xe[Ze];e.key===t?(Ze+=1,Ze>=Xe.length&&(Ye(),Ze=0)):Ze=0}))};const et=document.querySelector(".setup-container");function tt(e){console.log("log",e);let t=new Le(e);t.listener=function(t){!async function(e,t){console.log(t,e),e.casts=e.casts[t.id],e.buffs=e.buffs[t.id],e.targetDamage1S=e.targetDamage1S[t.id],e.casts.sort((function(e,t){return e.start-t.start}));const n={};for(let t of e.casts)n[t.id]=!0;for(let t in e.skills)/^[A-Z]/.test(e.skills[t])&&(n[t]=!0);let r=await function(e,t){const n=t.profession;if("Tempest"===n){if(t.weapons.includes("Dagger")){return Ee(e.skills.hasOwnProperty(o)?"tempest_condi_gos":"tempest_condi_ele")}return Ee("tempest_power")}if("Weaver"===n){let n=e.skills.hasOwnProperty(T),s=e.buffs.hasOwnProperty(y);if(!n)return t.weapons.includes("Staff")?Ee("weaver_power_staff"):Me(e,z)?Ee(s?"weaver_power_fa_large":"weaver_power_btth_large"):Ee(s?"weaver_power_fa_small":"weaver_power_btth_small");if(s){return Ee(e.skills.hasOwnProperty(o)?"weaver_hybrid_fa":"weaver_hybrid_fa_elementals")}if(t.weapons.includes("Sword"))return Ee("weaver_condi_sword");if(t.weapons.includes("Dagger"))return Ee("weaver_condi_dagger")}if("Chronomancer"===n)return t.weapons.includes("Shield")?t.weapons.includes("Scepter")?Ee("chrono_condi_boon"):Ee("chrono_power_boon"):t.weapons.includes("Greatsword")?Me(e,N)?Ee("chrono_power_gs"):Fe(t,1187)?Ee("chrono_power_quick_gs"):Ee("chrono_power_gs"):t.weapons.includes("Scepter")?Ee("chrono_condi"):Me(e,N)?Ee("chrono_power_focus"):Fe(t,1187)?Ee("chrono_power_quick_focus"):t.weapons.includes("Pistol")?Ee("chrono_power_pistol"):Ee("chrono_power_focus");if("Mirage"===n)return t.weapons.includes("Staff")?Ee("mirage_staff"):Ee("mirage");if("Reaper"===n)return t.weapons.includes("Scepter")?Ee("reaper_condi"):Ee("reaper");if("Scourge"===n)return Ee("scourge");if("Holosmith"===n)return t.weapons.includes("Sword")?Ee("holo_power_sword"):t.weapons.includes("Rifle")?Ee("holo_power_rifle"):Ee("holo_condi");if("Scrapper"===n)return Me(e,ue)?Ee("scrapper_quick"):Ee("scrapper");if("Soulbeast"===n)return t.weapons.includes("Shortbow")?Ee("soulbeast_condi_sb"):t.weapons.includes("Torch")?"Axe"===t.weapons[1]||"Axe"===t.weapons[3]?Ee("soulbeast_hybrid"):Ee("soulbeast_condi"):t.weapons.includes("Greatsword")?Ee("soulbeast_power_moa_gs"):Ee("soulbeast_power_moa_lb");if("Daredevil"===n)return t.weapons.includes("Staff")?Ee("daredevil_power"):Ee("daredevil_condi");if("Deadeye"===n){if(t.weapons.includes("Rifle"))return Ee("deadeye_rifle");if(t.weapons.includes("Pistol"))return Ee("deadeye_condi")}if("Dragonhunter"===n)return t.weapons.includes("Sword")?Me(e,se)?Ee("dragonhunter_sword_virtues"):Ee("dragonhunter_sword"):t.weapons.includes("Longbow")?Ee("dragonhunter_longbow"):Ee("dragonhunter_scepter");if("Guardian"===n)return Ee("guardian");if("Firebrand"===n)return Me(e,ee)?Ee("firebrand_condi"):t.weapons.includes("Greatsword")?Ee("firebrand_condi_gs"):Ee("firebrand_condi_quick");if("Herald"===n)return t.weapons.includes("Sword")?Ee("herald_boon"):Ee("herald_condi");if("Renegade"===n){if(t.weapons.includes("Sword"))return Ee("renegade_alac");let n=e.buffs.hasOwnProperty(de);return e.buffs.hasOwnProperty(ce)?Ee("renegade_shiro"):Ee(n?"renegade_deva_kalla":"renegade_kalla")}if("Berserker"===n){return t.weapons.includes("Longbow")?Me(e,V)?Ee("berserker_condi"):Ee("berserker_condi_banners"):Me(e,K)?Ee("berserker_power"):Ee("berserker_power_banners")}return"Spellbreaker"===n?Ee("spellbreaker_banners"):Promise.resolve({targetDamage10S:[],casts:[]})}(e,t);for(let e of r.casts)n[e.id]=!0;await s.load(n),document.getElementById("benchmark-name").textContent=r.name,r.casts.sort((function(e,t){return e.start-t.start})),document.querySelector(".container").classList.remove("hidden");const a=(e.end-e.start)/20,i=document.querySelector(".timeline"),u=document.querySelector(".gameplay-video"),h=document.createElement("div");h.classList.add("board-container"),h.classList.add("show-benchmark");const f=document.createElementNS("http://www.w3.org/2000/svg","svg");f.style.width=a+"px",f.classList.add("board"),h.appendChild(f);const p=document.createElementNS("http://www.w3.org/2000/svg","svg");p.classList.add("legend"),p.classList.add("show-benchmark");const g=document.createElementNS("http://www.w3.org/2000/svg","rect");function m(t){return a*(t-e.start)/(e.end-e.start)}function w(t){return t/a*(e.end-e.start)+e.start}g.setAttribute("x",0),g.setAttribute("y",0),g.setAttribute("width",2),g.classList.add("needle"),f.appendChild(g),i.appendChild(p),i.appendChild(h);const b={[l]:"Fire/Fire",[W]:"Fire/Air",[X]:"Fire/Water",[U]:"Fire/Earth",[c]:"Air/Air",[j]:"Air/Water",[q]:"Air/Fire",[I]:"Water/Fire",[J]:"Water/Earth",[d]:"Earth/Earth",[G]:"Earth/Air",[H]:"Earth/Fire"};for(const t in b)e.skills[t]=b[t],r.skills[t]=b[t];for(const t of r.casts)t.start+=e.start,t.end+=e.start;const v={railHeight:20,railPad:4,width:a,timeToX:m,xToTime:w},k={showBenchmark:!0,showDps:!0,showBoringBuffs:!1,videoOffset:1.8,showIcons:!1},S=document.getElementById("show-benchmark");S.checked=k.showBenchmark;const _=document.getElementById("show-dps");_.checked=k.showDps;const A=document.getElementById("show-boring-buffs");A.checked=k.showBoringBuffs;const $=document.getElementById("show-icons");function L(n){return function(s){console.log("onchange",n,s,s.target),k[n]=s.target.checked,nt(e,r,t,v,k)}}$.checked=k.showIcons,S.addEventListener("change",L("showBenchmark")),_.addEventListener("change",L("showDps")),A.addEventListener("change",L("showBoringBuffs")),$.addEventListener("change",L("showIcons")),nt(e,r,t,v,k);let x=h.getBoundingClientRect();function C(t,n){const s=m(t);g.setAttribute("x",s),(!n||s<h.scrollLeft||s>h.scrollLeft+x.width)&&(h.scrollLeft=s-x.width/2),n&&(u.currentTime=(t-e.start)/1e3+k.videoOffset)}f.addEventListener("click",(function(e){C(w(e.clientX+h.scrollLeft-x.left),!0)})),document.body.addEventListener("click",(function(e){if(e.target.classList.contains("time-link")){e.preventDefault();let t=parseFloat(e.target.dataset.start);t&&C(t,!0)}})),u.addEventListener("timeupdate",(function(){C(1e3*(u.currentTime-k.videoOffset)+e.start)})),pe(e,0,r),Qe()}(e,t)},t.render()}function nt(e,t,n,s,o){const{railHeight:r,railPad:a}=s,i=document.querySelector(".board"),l=document.querySelector(".legend"),c=document.querySelector(".needle");i.innerHTML="",l.innerHTML="";let d=0;if(o.showDps){Ue(i,e,t,s);const n=document.createElementNS("http://www.w3.org/2000/svg","text");n.textContent="Damage per 10s",n.setAttribute("x",0),n.setAttribute("y",r/2),n.classList.add("name"),l.appendChild(n),d+=3}if(o.showBenchmark){Oe(i,e,t.casts,d,s,"benchmark",o.showIcons?"icon":"name");const c=document.createElementNS("http://www.w3.org/2000/svg","text");c.textContent="Benchmark",c.setAttribute("x",0),c.setAttribute("y",d*(r+a)+r/2),c.classList.add("name"),l.appendChild(c),d+=1,function(e,t){let n={};for(let s in e.buffs)t.buffs.hasOwnProperty(s)?n[s]=t.buffs[s]:(t.skills[s]=t.skills[s]||e.skills[s],n[s]=[]);t.buffs=n}(e,t),Ie(i,l,t,n,d+1,s,o.showBoringBuffs,!0)}Oe(i,e,e.casts,d,s,null,o.showIcons?"icon":"name");const u=Ie(i,l,e,n,d+1,s,o.showBoringBuffs,!1)+1+d;i.style.height=u*(r+a)-a+"px",l.style.height=u*(r+a)-a+"px",c.setAttribute("height",u*(r+a)-a),i.appendChild(c)}!async function(){const e=document.querySelector(".dpsreport-text"),t=document.querySelector(".dpsreport-submit");function n(){let o=e.value.trim();if(!/^https:\/\/dps\.report\/[^/]+$/.test(o))return void alert("Paste in format https://dps.report/Sosx-20180802-193036_cairn");let r=new URL(o);var a;t.value="Fetching",t.removeEventListener("click",n),t.removeEventListener("keypress",s),a=r.pathname.substr(1),Ce.a.getJson(a).then((function(e){e&&(et.classList.add("hidden"),tt(e))})).catch(e=>{alert("failed to fetch that log, typo maybe?")})}function s(e){"Enter"===e.key&&n()}t.addEventListener("click",n),e.addEventListener("keypress",s);let o=document.getElementById("log-input");o.addEventListener("change",(function(){document.querySelector("#log-input + label").textContent="Parsing";let e=o.files[0];setTimeout((function(){!function(e){const t=new FileReader;t.onload=function(e){try{const t=e.target.result;let n=Ce.a.parseJson(JSON.parse(t));et.classList.add("hidden"),tt(n)}catch(e){alert("Failed to parse log file, should be JSON blob")}},t.readAsText(e)}(e)}),100)})),et.classList.remove("hidden");let r=document.querySelector(".gameplay-video-container"),a=document.querySelector(".gameplay-video"),i=document.getElementById("video-input");i.addEventListener("change",(function(){let e=document.querySelector("#video-input + label");e.textContent="Uploading";let t=i.files[0];setTimeout((function(){const n=new FileReader;n.onload=function(e){console.log("woot");let n=document.createElement("source");n.src=e.target.result,n.type=t.type,a.appendChild(n),r.classList.remove("no-video")},n.onprogress=function(t){if(t.lengthComputable){let n=Math.floor(100*t.loaded/t.total)+"%";e.textContent="Uploading "+n}},n.readAsDataURL(t)}),100)}))}()}]);